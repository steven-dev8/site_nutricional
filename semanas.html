<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semanas</title>
    <link rel="stylesheet" href="css/tabela_diaria.css">
    <script>
        function dimensaoTela() {
            var heightTela = window.innerHeight;
            document.getElementById('pag_processos').style.minHeight = heightTela + 'px';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body id="pag_processos" onload="dimensaoTela()">
    <header>
        <div class="logo">
            <img src="assets/image/logo_apenas_imagem.png" alt="logo" class="img_logo">
        </div>
    </header>
    <div class="container">
        <table class="adicionar">
            <tr>
                <td><input type="checkbox" class="refeicao" value="primeira"> 1ª REFEIÇÃO</td>
                <td><input type="checkbox" class="refeicao" value="segunda"> 2ª REFEIÇÃO</td>
                <td><input type="checkbox" class="refeicao" value="terceira"> 3ª REFEIÇÃO</td>
                <td><input type="checkbox" class="refeicao" value="quarta"> 4ª REFEIÇÃO</td>
            </tr>
            <tr>
                <td colspan="4" style="text-align:center">
                    <button class="botao" onclick="addRefeicao()">Adicionar</button>
                    <button class="botao" onclick="window.location.href='index.html'">Voltar</button>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="text-align:center">
                    <button class="botao_maior" onclick="limparRef()">LIMPAR REFEIÇÕES</button>
                </td>
            </tr>
        </table>
        <table class="refeicoes">
            <caption>Refeições do dia</caption>
            <tr>
                <td>REFEIÇÕES</td> <td>CARBOIDRATOS</td> <td>PROTEÍNAS</td> <td>GORDURAS</td>
            </tr>
            <tr>
                <td>1ª REFEIÇÃO</td> <td id="carbo1"></td> <td id="prot1"></td> <td id="gord1"></td>
            </tr>
            <tr>
                <td>2ª REFEIÇÃO</td> <td id="carbo2"></td> <td id="prot2"></td> <td id="gord2"></td>
            </tr>
            <tr>
                <td>3ª REFEIÇÃO</td> <td id="carbo3"></td> <td id="prot3"></td> <td id="gord3"></td>
            </tr>
            <tr>
                <td>4ª REFEIÇÃO</td> <td id="carbo4"></td> <td id="prot4"></td> <td id="gord4"></td>
            </tr>
        </table>
        <table class="semana">
            <caption>Dias da semana</caption>
            <tr>
                <td class="btn">DIA</td>
                <td>CARBOIDRATO</td>
                <td>PROTEINA</td>
                <td>GORDURA</td>
            </tr>
            <tr>
                <td>DIA 1</td> <td id="carboDia1"></td> <td id="protDia1"></td> <td id="gordDia1"></td>
            </tr>
            <tr>
                <td>DIA 2</td> <td id="carboDia2"></td> <td id="protDia2"></td> <td id="gordDia2"></td>
            </tr>
            <tr>
                <td>DIA 3</td> <td id="carboDia3"></td> <td id="protDia3"></td> <td id="gordDia3"></td>
            </tr>
            <tr>
                <td>DIA 4</td> <td id="carboDia4"></td> <td id="protDia4"></td> <td id="gordDia4"></td>
            </tr>
            <tr>
                <td>DIA 5</td> <td id="carboDia5"></td> <td id="protDia5"></td> <td id="gordDia5"></td>
            </tr>
            <tr>
                <td>DIA 6</td> <td id="carboDia6"></td> <td id="protDia6"></td> <td id="gordDia6"></td>
            </tr>
            <tr>
                <td>DIA 7</td> <td id="carboDia7"></td> <td id="protDia7"></td> <td id="gordDia7"></td>
            </tr>
        </table>
    </div>


    <script>

        const alimentos = {
            'Arroz branco': { carboidratos: 28.2, proteinas: 2.7, gorduras: 0.3 },
            'Feijão': { carboidratos: 20.0, proteinas: 9.0, gorduras: 0.5 },
            'Pão francês': { carboidratos: 50.0, proteinas: 9.0, gorduras: 2.5 },
            'Laranja': { carboidratos: 11.75, proteinas: 0.94, gorduras: 0.12 },
            'Carne Bovina': { carboidratos: 0.0, proteinas: 26.0, gorduras: 20.0 },
            'Carne de Frango': { carboidratos: 0.0, proteinas: 31.0, gorduras: 3.6 },
            'Ovo': { carboidratos: 0.73, proteinas: 13.0, gorduras: 10.0 },
            'Café': { carboidratos: 0.0, proteinas: 0.0, gorduras: 0.0 },
            'Banana': { carboidratos: 22.84, proteinas: 1.09, gorduras: 0.33 },
            'Batata Branca': { carboidratos: 17.58, proteinas: 2.02, gorduras: 0.1 }
        };

        const valores = new URLSearchParams(window.location.search);
        let dados = {};
        valores.forEach((value, key) => {
            dados[key] = value;
        });

        let local = [
        localStorage.getItem('primeira') ? localStorage.getItem('primeira').split(',') : [],
        localStorage.getItem('segunda') ? localStorage.getItem('segunda').split(',') : [],
        localStorage.getItem('terceira') ? localStorage.getItem('terceira').split(',') : [],
        localStorage.getItem('quarta') ? localStorage.getItem('quarta').split(',') : []
    ];
        
        let info = { carboidrato: 0, proteina: 0, gordura: 0 };
        Object.keys(dados).forEach(key => {
            if (alimentos[key]) {
                info.carboidrato += (alimentos[key].carboidratos * dados[key] / 100);
                info.proteina += (alimentos[key].proteinas * dados[key] / 100);
                info.gordura += (alimentos[key].gorduras * dados[key] / 100);
            }
        });

    function atualizarNutri(){
        let refeicaoTotal = {
            carboidratos: (parseFloat(local[0][0] || 0) + parseFloat(local[1][0] || 0) +
                        parseFloat(local[2][0] || 0) + parseFloat(local[3][0] || 0)),
            proteinas: (parseFloat(local[0][1] || 0) + parseFloat(local[1][1] || 0) +
                        parseFloat(local[2][1] || 0) + parseFloat(local[3][1] || 0)),
            gorduras: (parseFloat(local[0][2] || 0) + parseFloat(local[1][2] || 0) +
                    parseFloat(local[2][2] || 0) + parseFloat(local[3][2] || 0))}
};
        atualizarNutri()
    
    function refTotal(){
        let carbo_total = 0  
        let prot_total = 0
        let gord_total = 0

        local.forEach(item => {
            carbo_total += parseFloat(item[0]) || 0
            prot_total += parseFloat(item[1]) || 0
            gord_total += parseFloat( item[2]) || 0
        })
        return {carbo_total, prot_total, gord_total};

    }

    let diaAtual = 1;  

function add_dias_semanas() {
    window.location.reload()
    const { carbo_total, prot_total, gord_total } = refTotal();
    if (diaAtual <= 7){

    $('#carboDia' + String(diaAtual)).text(carbo_total + 'g');
    $('#protDia' + String(diaAtual)).text(prot_total + 'g');
    $('#gordDia' + String(diaAtual)).text(gord_total + 'g');
    diaAtual += 1;
} else{
    alert('todos os dias já foram completos')
}    
    
}


    function recurperarItens(){
        if (localStorage.getItem('primeira')){
            $('#carbo').text(local[0][0] + 'g');
            $('#prot1').text(local[0][1] + 'g');
            $('#gord1').text(local[0][2] + 'g');
        }

        if (localStorage.getItem('segunda')){
            $('#carbo2').text(local[1][0] + 'g');
            $('#prot2').text(local[1][1] + 'g');
            $('#gord2').text(local[1][2] + 'g');
        }

        if (localStorage.getItem('terceira')){
            $('#carbo3').text(local[2][0] + 'g');
            $('#prot3').text(local[2][1] + 'g');
            $('#gord3').text(local[2][2] + 'g');
        }

        if (localStorage.getItem('quarta')){
            $('#carbo4').text(local[3][0] + 'g');
            $('#prot4').text(local[3][1] + 'g');
            $('#gord4').text(local[3][2] + 'g');
        
        }}

        recurperarItens()

        function limparRef(){
            localStorage.getItem('primeira') ? localStorage.removeItem('primeira'): null,
            localStorage.getItem('segunda') ? localStorage.removeItem('segunda'): null,
            localStorage.getItem('terceira') ? localStorage.removeItem('terceira'): null,
            localStorage.getItem('quarta') ? localStorage.removeItem('quarta'): null
            location.reload()
        }

        function addRefeicao() {
    atualizarNutri();  
    let valoresMarcados = [];
    $('input[type="checkbox"]:checked').each(function () {
        valoresMarcados.push($(this).val());
    });

    const refeicoes = {
        'primeira': ['#carbo1', '#prot1', '#gord1'],
        'segunda': ['#carbo2', '#prot2', '#gord2'],
        'terceira': ['#carbo3', '#prot3', '#gord3'],
        'quarta': ['#carbo4', '#prot4', '#gord4']
    };

    valoresMarcados.forEach((refeicao) => {
        const [carbo, prot, gord] = refeicoes[refeicao];
        localStorage.setItem(refeicao, [info.carboidrato, info.proteina, info.gordura]);
        $(carbo).text(info.carboidrato + 'g');
        $(prot).text(info.proteina + 'g');
        $(gord).text(info.gordura + 'g');
        
    });

}

    </script>

    <div class="container2">
        <table>
            <tr>
                <td>Carboidratos: <input type="text" id="carbo"></td>
                <td>Proteínas: <input type="text" id="prot"></td>
                <td>Gordura: <input type="text" id="gord"></td>
            </tr>
        </table>
        <button class="botao2" onclick="add_dias_semanas()">Adicionar dia a semana</button>
        <button id="botao_dia" class="botao2" onclick="atualizarGrafico()">Comparar dias e metas</button>
        <div class="grafico">
            <canvas id="metas"></canvas>
        </div>
    </div>

    <footer><p>© aNutriLife - Since 2024</p></footer>

    <script>
        let chart1;
$(document).ready(function() {
    const ctx = $('#metas');
    chart1 = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Dia 1', 'Dia 2', 'Dia 3'],
            datasets: [
                {
                    label: 'Carboidratos(g)',
                    data: [],
                    borderColor: '#6fe904',
                    backgroundColor: 'rgba(111, 233, 4, 0.2)',
                    tension: 0.4,
                    fill: false
                },
                {
                    label: 'Proteínas(g)',
                    data: [],
                    borderColor: '#608E37',
                    backgroundColor: 'rgba(96, 142, 55, 0.2)',
                    tension: 0.4,
                    fill: false
                },
                {
                    label: 'Gorduras(g)',
                    data: [],
                    borderColor: '#36521f',
                    backgroundColor: 'rgba(54, 82, 31, 0.2)',
                    tension: 0.4,
                    fill: false
                },
                {
                    label: 'Meta Carboidratos(g)',
                    data: [],
                    borderColor: '#FA9F00',
                    backgroundColor: 'rgba(250, 159, 0, 1)',
                    tension: 0.4,
                    fill: false,
                    borderDash: [5, 5], 
                },
                {
                    label: 'Meta Proteínas(g)',
                    data: [],
                    borderColor: '#FA9F00',
                    backgroundColor: 'rgba(250, 159, 0, 1)',
                    tension: 0.4,
                    fill: false,
                    borderDash: [5, 5],
                },
                {
                    label: 'Meta Gorduras(g)',
                    data: [],
                    borderColor: '#FA9F00',
                    backgroundColor: 'rgba(250, 159, 0, 1)',
                    tension: 0.4,
                    fill: false,
                    borderDash: [5, 5],
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'METAS' }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});


function atualizarGrafico() {
    let carboidratos = refeicaoTotal.carboidratos
    let proteinas = refeicaoTotal.proteinas
    let gorduras = refeicaoTotal.gorduras
    let metas = [$('#carbo').val(), $('#prot').val(), $('#gord').val()];

    chart1.data.datasets[0].data.push(carboidratos); 
    chart1.data.datasets[1].data.push(proteinas);    
    chart1.data.datasets[2].data.push(gorduras);

    chart1.data.datasets[3].data.push(parseFloat(metas[0])); 
    chart1.data.datasets[4].data.push(parseFloat(metas[1])); 
    chart1.data.datasets[5].data.push(parseFloat(metas[2])); 

    chart1.update(); 
}
    </script>
